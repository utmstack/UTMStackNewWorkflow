import {Component, Input, OnInit} from '@angular/core';
import {UtmToastService} from '../../../../shared/alert/utm-toast.service';
import {VsTaskResultService} from '../../services/vs-task-result.service';

@Component({
  selector: 'app-vs-task-result-export',
  templateUrl: './vs-task-result-export.component.html',
  styleUrls: ['./vs-task-result-export.component.css']
})
export class VsTaskResultExportComponent implements OnInit {
  @Input() buttonTye: 'icon' | 'button' = 'button';
  generateReport = false;
  @Input() taskUUid: string;
  @Input() basic: boolean;

  constructor(private vsTaskResultService: VsTaskResultService,
              private toastService: UtmToastService) {
  }

  ngOnInit() {
  }

  viewReportTask() {
    this.generateReport = true;
    this.vsTaskResultService.exportResultToPdf(this.taskUUid, this.basic)
      .subscribe(pdf => {
        this.downloadPdf(pdf);
      });
  }

  downloadPdf(dat) {
    const data = new Blob([dat], {type: 'application/pdf'});
    this.generateReport = false;
    if (data.size > 0) {
      const reader = new FileReader();
      reader.readAsDataURL(data);
      reader.onloadend = () => {
        const base64data = reader.result.toString();
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', base64data);
        linkElement.setAttribute('download', 'UTMStack vulnerabilities report');
        linkElement.click();
      };
    } else {
      this.toastService.showWarning('NO DATA FOUND', 'No data found for this report');
    }
  }

}
