<div class="container-fluid pr-3 pl-3 pt-2 mb-3">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <div class="d-flex justify-content-start align-items-center">
      <h5 class="card-title mb-0 text-uppercase label-header">Vulnerabilities Result for </h5>
      <h4 *ngIf="typeResult ===taskResultParamType.TYPE_TASK && task" class="text-blue-800 label-header">
        &nbsp;TASK {{task.taskName}}</h4>
      <h4 *ngIf="typeResult ===taskResultParamType.TYPE_ASSET && hostResult" class="text-blue-800 label-header">&nbsp;
        HOST {{hostResult}}</h4>
    </div>

    <div class="header-elements">
      <button class="btn utm-button utm-button-primary" routerLink="/vulnerability-scanner/tasks">
        <i class="icon-task mr-2"></i> View tasks
      </button>

      <app-vs-task-result-export *ngIf="task && task.taskStatus===taskStatusEnum.DONE"
                                 [basic]="false"
                                 [buttonTye]="'button'"
                                 [taskUUid]="task.taskUuid"
      ></app-vs-task-result-export>
    </div>
  </div>

  <div class="card h-100 w-100">
    <div class="card bg-light border-0 m-0">
      <div class="d-flex p-2 m-1 justify-content-between align-items-center">
        <span (click)="viewSeverityHelp()" class="text-blue-800 cursor-pointer"
              ngbTooltip="View severity info"
              placement="left" tooltipClass="utm-tooltip">
             <i class="icon-info22"></i>
           </span>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table text-nowrap">
        <thead>
        <tr>
          <th (sort)="onSortBy($event)" appColumnSortable
              class="font-weight-semibold text-uppercase"
              sortable="result_name"
              style="width: 35%">
            Vulnerability&nbsp;
          </th>
          <th (sort)="onSortBy($event)" appColumnSortable
              class="font-weight-semibold text-uppercase text-center"
              sortable="result_severity"
              style="width: 150px">
            Severity&nbsp;
          </th>
          <th (sort)="onSortBy($event)"
              appColumnSortable
              class="font-weight-semibold text-uppercase text-center"
              sortable="result_qod"
              style="width: 50px">
            QoD&nbsp;
          </th>
          <th (sort)="onSortBy($event)" appColumnSortable
              class="font-weight-semibold text-uppercase"
              sortable="result_port"
              style="width: 150px">
            Location&nbsp;
          </th>
          <th (sort)="onSortBy($event)" appColumnSortable
              class="font-weight-semibold text-uppercase"
              sortable="result_port"
              style="width: 150px">
            Date&nbsp;
          </th>
          <th (sort)="onSortBy($event)" appColumnSortable
              class="font-weight-semibold text-uppercase"
              sortable="result_host"
              style="width: 15%">
            Asset&nbsp;
          </th>
        </tr>
        </thead>
        <tbody [hidden]="loading">
        <tr (click)="viewDetail =detail" *ngFor="let detail of results" class="cursor-pointer">
          <td>
            <span class="text-blue-800">{{detail.resultName}}</span>
          </td>
          <td class="text-center">
            <app-vs-severity [severity]="detail.resultSeverity"></app-vs-severity>
          </td>

          <td class="text-center">
            <span>{{detail.resultQod / 100 | percent}}</span>
          </td>
          <td>
            <span>{{detail.resultPort}}</span>
          </td>
          <td>
            <span>{{detail.resultDate|date:'short':'UTC'}}</span>
          </td>
          <td>
                <span
                  (click)="viewAssetDetail(detail.resultHost)"
                  class="text-blue-800 cursor-pointer"
                  ngbTooltip="View asset detail"
                  placement="left"
                  tooltipClass="utm-tooltip">{{detail.resultHost}}
                </span>
          </td>
        </tr>
        </tbody>
        <tbody *ngIf="results.length === 0 && !loading">
        <tr>
          <td colspan="7">
            <app-no-data-found></app-no-data-found>
          </td>
        </tr>
        </tbody>
        <tbody *ngIf="loading">
        <tr>
          <td colspan="7">
            <div class="p-5 d-flex  justify-content-center align-items-center text-blue-800">
              <app-utm-spinner [height]="'35px'"
                               [label]="'Loading results'"
                               [loading]="loading"
                               [width]="'35px'">
              </app-utm-spinner>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="results && results.length>0" class="mb-4">
      <div class="row justify-content-center">
        <ngb-pagination
          (pageChange)="loadPage($event)"
          [(page)]="page"
          [boundaryLinks]="true"
          [collectionSize]="totalItems"
          [maxSize]="10"
          [pageSize]="itemsPerPage"
          [rotate]="true"
          [size]="'sm'"></ngb-pagination>
      </div>
    </div>
  </div>
</div>


<div *ngIf="viewDetail" class="utm-right-container">
  <div (click)="viewDetail= undefined" class="overlay overlay-lg"></div>
  <div class="card utm-right-action utm-right-action-lg">
    <div class="title d-flex justify-content-between  align-items-center border-bottom-1
     border-bottom-grey-100  pl-3 pt-3 pr-3 pb-0">
      <h6 class="card-title text-blue-800 font-weight-light">
        Detail of {{viewDetail.resultName}}
      </h6>
      <button (click)="viewDetail= undefined" aria-label="Close"
              class="close button-close" type="button">
        <div class="close-icon"></div>
      </button>
    </div>
    <app-vulnerabilities-detail [detail]="viewDetail"></app-vulnerabilities-detail>
  </div>
</div>
