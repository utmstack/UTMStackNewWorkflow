import {Component, Input, OnDestroy, OnInit} from '@angular/core';
import {Router} from '@angular/router';
import {NgxSpinnerService} from 'ngx-spinner';
import {ChartSerieValueType} from '../../../../../shared/types/chart-reponse/chart-serie-value.type';
import {VsVulnerabilityOverviewService} from '../../services/vs-vulnerability-overview.service';

@Component({
  selector: 'app-vs-vul-metrics',
  templateUrl: './vs-vul-metrics.component.html',
  styleUrls: ['./vs-vul-metrics.component.css']
})
export class VsVulMetricsComponent implements OnInit, OnDestroy {
  @Input() refreshInterval = 30000;
  interval: any;
  vulMetrics: ChartSerieValueType[];
  loading = true;

  constructor(private vsVulnerabilityOverviewService: VsVulnerabilityOverviewService,
              private router: Router,
              private spinner: NgxSpinnerService) {
  }

  ngOnInit() {
    this.getVulnerabilitiesStatus();
    if (this.refreshInterval) {
      this.interval = setInterval(() => {
        this.getVulnerabilitiesStatus();
      }, this.refreshInterval);
    }
  }


  getVulnerabilitiesStatus() {
    this.vsVulnerabilityOverviewService.getVulnerabilitiesMetrics().subscribe(res => {
      this.vulMetrics = res.body;
      this.loading = false;
    });
  }

  ngOnDestroy(): void {
    clearInterval(this.interval);
  }

  chartEvent(status?: number) {
    // const queryParams = {dataNature: DataNatureTypeEnum.ALERT};
    // queryParams[ALERT_GLOBAL_FIELD] = 'alert';
    // queryParams[ALERT_STATUS_FIELD] = ElasticOperatorsEnum.IS + '->' + status;
    // queryParams[ALERT_TIMESTAMP_FIELD] = ElasticOperatorsEnum.IS_BETWEEN + '->' + this.time.timeFrom + ',' + this.time.timeTo;
    // queryParams[EVENT_IS_ALERT] = ElasticOperatorsEnum.IS + ChartValueSeparator.BUCKET_SEPARATOR + 'true';
    // this.spinner.show('loadingSpinner');
    // this.router.navigate(['/data/alert/view'], {
    //   queryParams
    // }).then(() => {
    //   this.spinner.hide('loadingSpinner');
    // });
  }

  getColor(serie: string) {
    if (serie === 'Total') {
      return '#000';
    } else {
      return '#EF5350';
    }
  }

  getIcon(serie: string) {
    if (serie === 'Total') {
      return 'icon-checkbox-checked2';
    } else {
      return ' icon-warning22';
    }
  }

}
