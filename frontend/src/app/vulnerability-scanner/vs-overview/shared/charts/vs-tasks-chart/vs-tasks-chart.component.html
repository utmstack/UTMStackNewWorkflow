<div class="card">
  <div class="card-header card-header-chart p-2 d-flex
   justify-content-between align-items-center bg-white">
    <label class="card-title label-header text-blue-800">
      Top 10 most vulnerable host
    </label>
    <app-elastic-filter-time (timeFilterChange)="onTimeChange($event)"
                             [formatInstant]="true"
                             [invertContent]="true"
                             [timeDefault]="defaultTime"
                             changeOnInit="YES">
    </app-elastic-filter-time>
  </div>

  <div class="card-body p-2 w-100">
    <div *ngIf="loading"
         class="loading-chart w-100 h-100
                 chart chart-fixed-height
                 d-flex justify-content-center
                 align-items-center">
      <app-utm-spinner [loading]="loading"
                       label="Loading chart">
      </app-utm-spinner>
    </div>
    <div *ngIf="!loading" class="table-responsive w-100 chart-fixed-height overflow-auto">
      <table class="table text-nowrap">
        <thead>
        <tr>
          <th (sort)="onSortBy($event)"
              appColumnSortable
              class="font-weight-semibold"
              sortable="task_name"
              style="width: 20%">
            Name&nbsp;
          </th>
          <th (sort)="onSortBy($event)" appColumnSortable
              class="font-weight-semibold text-center"
              sortable="task_status"
              style="width: 12%">
            Status&nbsp;
          </th>
          <th (sort)="onSortBy($event)"
              appColumnSortable
              class="font-weight-semibold"
              sortable="task_creation_time">
            Created at&nbsp;
          </th>
          <th (sort)="onSortBy($event)"
              appColumnSortable
              class="font-weight-semibold text-center"
              sortable="scan_result_severity"
              style="width: 100px">
            Severity&nbsp;
          </th>
          <th (sort)="onSortBy($event)"
              appColumnSortable
              class="font-weight-semibold text-center"
              sortable="scan_high_results_count">
            High&nbsp;
          </th>
          <th (sort)="onSortBy($event)"
              appColumnSortable
              class="font-weight-semibold text-center"
              sortable="scan_medium_results_count">
            Medium&nbsp;
          </th>
          <th (sort)="onSortBy($event)"
              appColumnSortable
              class="font-weight-semibold text-center"
              sortable="scan_low_results_count">
            Low&nbsp;
          </th>
        </tr>
        </thead>
        <tbody [hidden]="tasks.length===0 && !loading">
        <tr *ngFor="let task of tasks">
          <td (click)="viewTaskResult(task)" class="cursor-pointer" style="width: 15%">
                <span class="text-blue-800">
                   {{task.taskName}}
                </span>
          </td>
          <td (click)="viewTaskResult(task)" class="text-center cursor-pointer" style="width: 15%">
            <app-vs-task-status [task]="task"></app-vs-task-status>
          </td>
          <td (click)="viewTaskResult(task)" class="cursor-pointer" style="width: 5%">
                <span *ngIf="task.taskCreationTime">
                   {{task.taskCreationTime|date:'short':'UTC'}}
                </span>
          </td>
          <td (click)="viewTaskResult(task)" class="text-center cursor-pointer">
            <app-vs-severity [severity]="task.scanResultSeverity"></app-vs-severity>
          </td>
          <td (click)="viewTaskResult(task)" class="text-center">
                <span class="text-danger-300 font-size-lg">
                    {{(task.scanHighResultsCount ? task.scanHighResultsCount : 0) | thousandSuff}}
                </span>
          </td>
          <td (click)="viewTaskResult(task)" class="text-center">
                <span class="text-orange-300 font-size-lg">
                    {{(task.scanMediumResultsCount ? task.scanMediumResultsCount : 0) | thousandSuff}}
                  </span>
          </td>
          <td (click)="viewTaskResult(task)" class="text-center">
                <span class="text-info-300 font-size-lg">
                    {{(task.scanLowResultsCount ? task.scanLowResultsCount : 0) | thousandSuff}}
                  </span>
          </td>
        </tr>
        </tbody>
        <tbody *ngIf="(tasks && tasks.length === 0 && !loading)">
        <tr>
          <td colspan="6">
            <app-no-data-found></app-no-data-found>
          </td>
        </tr>
        </tbody>
        <tbody *ngIf="loading">
        <tr>
          <td colspan="6">
            <div class="p-5 d-flex  justify-content-center align-items-center text-blue-800">
              <app-utm-spinner [height]="'35px'"
                               [label]="'Loading tasks'"
                               [loading]="loading"
                               [width]="'35px'">
              </app-utm-spinner>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
      <div *ngIf="tasks && tasks.length>0" class="mb-4">
        <div class="row m-0 justify-content-center">
          <ngb-pagination
            (pageChange)="loadPage($event)"
            [boundaryLinks]="true"
            [collectionSize]="totalItems"
            [maxSize]="5"
            [pageSize]="request.size"
            [rotate]="true"
            [size]="'sm'"></ngb-pagination>
        </div>
      </div>
    </div>
  </div>
</div>

